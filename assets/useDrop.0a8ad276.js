var f=Object.defineProperty;var D=(r,t,e)=>t in r?f(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var n=(r,t,e)=>(D(r,typeof t!="symbol"?t+"":t,e),e);import{w as I,u as c,d as C,c as m,a as O,b}from"./connectDragRef.a5dc16fa.js";import{v as g,x as M,y as v,q as s,u as o,w as d}from"./vendor.5fb5b3db.js";let a=!1;class R{constructor(t){n(this,"internalMonitor");n(this,"targetId",null);this.internalMonitor=t.getMonitor()}receiveHandlerId(t){this.targetId=t}getHandlerId(){return this.targetId}subscribeToStateChange(t,e){return this.internalMonitor.subscribeToStateChange(t,e)}canDrop(){if(!this.targetId)return!1;g(!a,"You may not call monitor.canDrop() inside your canDrop() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target-monitor");try{return a=!0,this.internalMonitor.canDropOnTarget(this.targetId)}finally{a=!1}}isOver(t){return this.targetId?this.internalMonitor.isOverTarget(this.targetId,t):!1}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}}class y{constructor(t){n(this,"hooks",I({dropTarget:(t,e)=>{this.clearDropTarget(),this.dropTargetOptions=e,v(t)?this.dropTargetRef=t:this.dropTargetNode=t,this.reconnect()}}));n(this,"handlerId",null);n(this,"dropTargetRef",null);n(this,"dropTargetNode");n(this,"dropTargetOptionsInternal",null);n(this,"unsubscribeDropTarget");n(this,"lastConnectedHandlerId",null);n(this,"lastConnectedDropTarget",null);n(this,"lastConnectedDropTargetOptions",null);n(this,"backend");this.backend=t}get connectTarget(){return this.dropTarget}reconnect(){const t=this.didHandlerIdChange()||this.didDropTargetChange()||this.didOptionsChange();t&&this.disconnectDropTarget();const e=this.dropTarget;if(!!this.handlerId){if(!e){this.lastConnectedDropTarget=e;return}t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDropTarget=e,this.lastConnectedDropTargetOptions=this.dropTargetOptions,this.unsubscribeDropTarget=this.backend.connectDropTarget(this.handlerId,e,this.dropTargetOptions))}}receiveHandlerId(t){t!==this.handlerId&&(this.handlerId=t,this.reconnect())}get dropTargetOptions(){return this.dropTargetOptionsInternal}set dropTargetOptions(t){this.dropTargetOptionsInternal=t}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didDropTargetChange(){return this.lastConnectedDropTarget!==this.dropTarget}didOptionsChange(){return!M(this.lastConnectedDropTargetOptions,this.dropTargetOptions)}disconnectDropTarget(){this.unsubscribeDropTarget&&(this.unsubscribeDropTarget(),this.unsubscribeDropTarget=void 0)}get dropTarget(){return this.dropTargetNode||this.dropTargetRef&&this.dropTargetRef.value}clearDropTarget(){this.dropTargetRef=null,this.dropTargetNode=null}}function H(r){return s(()=>{const t=o(r).accept;return g(t!=null,"accept must be defined"),Array.isArray(t)?t:[t]})}class k{constructor(t,e){this.spec=t,this.monitor=e}canDrop(){const t=this.spec,e=this.monitor;return t.canDrop?t.canDrop(e.getItem(),e):!0}hover(){const t=this.spec,e=this.monitor;t.hover&&t.hover(e.getItem(),e)}drop(){const t=this.spec,e=this.monitor;if(t.drop)return t.drop(e.getItem(),e)}}function w(r,t){const e=s(()=>new k(o(r),o(t)));return d(()=>{e.value.spec=o(r)}),e}function S(r,t,e){const i=c(),l=w(r,t),u=H(r);d(function(h){const[p,T]=C(u,l,i);o(t).receiveHandlerId(p),o(e).receiveHandlerId(p),h(T)})}function N(){const r=c();return s(()=>new R(o(r)))}function A(r){const t=c(),e=s(()=>new y(o(t).getBackend()));return d(i=>{e.value.dropTargetOptions=o(r)||null,e.value.reconnect(),i(()=>e.value.disconnectDropTarget())}),e}function F(r,t){return s(()=>m(o(r).hooks.dropTarget(),o(t).options))}function P(r){const t=b(r),e=N(),i=A(s(()=>o(t).options));return S(t,e,i),[O(s(()=>o(t).collect||(()=>({}))),e,i),F(i,t)]}export{P as u};
